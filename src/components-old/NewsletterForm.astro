---
export interface Props {
  className?: string;
}

const { className = '' } = Astro.props;
---

<div class={`newsletter-wrap ${className}`}>
  <h3 id="newsletter-signup">Join my mailing list to keep up to date with the latest!</h3>
  <form 
    class="newsletter__form"
    action="https://app.convertkit.com/forms/1863867/subscriptions"
    method="post"
  >
    <label>
      <span class="labelText">Enter your email:</span>
      <input
        class="newsletter__field"
        type="email"
        id="email_address"
        name="email_address"
        placeholder="you@email.com"
        required
      />
    </label>
    <button type="submit">Subscribe</button>
  </form>

  <div aria-live="polite" id="newsletter-status">
    <!-- Status messages will be handled by JavaScript -->
  </div>
  
  <p class="privacy-note">
    This adds you to my TestingAccessibility.com subscriber list.<br />
    I will not sell or share your information, period. Read my <a href="/privacy/">Privacy Policy</a>
  </p>
</div>

<script>
  // Add basic form submission handling
  const form = document.querySelector('.newsletter__form') as HTMLFormElement;
  const statusDiv = document.getElementById('newsletter-status');
  
  if (form && statusDiv) {
    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const formData = new FormData(form);
      
      try {
        const res = await fetch(form.action, {
          method: 'POST',
          body: formData,
          headers: {
            'Accept': 'application/json',
          },
        });
        
        const json = await res.json();
        
        if (json.status === 'success') {
          statusDiv.innerHTML = '<p><span aria-hidden="true">✨</span> Please check your inbox to confirm your subscription. <span aria-hidden="true">✨</span></p>';
        } else {
          statusDiv.innerHTML = '<p><span aria-hidden="true">❌ </span>Oops, Something went wrong! please try again.<span aria-hidden="true"> ❌</span></p>';
        }
      } catch (err) {
        statusDiv.innerHTML = '<p><span aria-hidden="true">❌ </span>Oops, Something went wrong! please try again.<span aria-hidden="true"> ❌</span></p>';
      }
    });
  }
</script>
